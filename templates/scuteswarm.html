<!DOCTYPE html>
<html>
<head>
    <title>Scute Swarm Calculator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="manifest" href="/static/manifest.json">
    <meta name="theme-color" content="#1976d2">
    <link rel="icon" href="/static/img/scuteswarm.png">
    <link rel="stylesheet" href="/static/css/scuteswarm.css">
    <link rel="stylesheet" href="/static/css/subpage.css">
    
    <script>
    function increment(id) {
        const input = document.getElementById(id);
        const value = parseInt(input.value, 10);
        input.value = isNaN(value) ? 1 : value + 1;
    }
    function decrement(id) {
        const input = document.getElementById(id);
        const value = parseInt(input.value, 10);
        input.value = isNaN(value) || value <= 0 ? 0 : value - 1;
    }
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('/static/js/service-worker.js');
      });
    }
</script>
</head>
<body>
    <a href="/" class="back-arrow" aria-label="Back to main page">&#8592;</a>
    <form method="post" class="container">
        <div class="top-row">
            <div class="section green">
                <div class="input-group">
                    <div class="input-label">Scute Swarms</div>
                    <div class="input-controls">
                        <button type="button" onclick="decrement('initial')">-</button>
                        <input id="initial" type="number" name="initial" placeholder="Scute Swarms" value="{{ initial }}" required>
                        <button type="button" onclick="increment('initial')">+</button>
                    </div>
                </div>
            </div>

            <div class="section tan">      
                <div class="input-group">
                    <div class="input-label">Lands Played</div>
                    <div class="input-controls">
                        <button type="button" onclick="decrement('lands')">-</button>
                        <input id="lands" type="number" name="lands" placeholder="Lands Played" value="{{ lands }}" required>
                        <button type="button" onclick="increment('lands')">+</button>
                    </div>
                </div> 
            </div>
            <div class="section blue">
                <div class="input-group">
                    <div class="input-label">Doublers</div>
                    <div class="input-controls">
                        <button type="button" onclick="decrement('doubler')">-</button>
                        <input id="doubler" type="number" name="doubler" placeholder="Doublers" value="{{ doubler }}" required>
                        <button type="button" onclick="increment('doubler')">+</button>
                    </div>
                </div>
            </div>
        </div>
        <button type="submit">Calculate</button>
        <div class="section blue result" id="result-section">
            <span id="final-swarms-value" style="font-size: 100pt; font-weight: bold; width: 100%; text-align: center; display: block;">
                {% if final_swarms is not none %}{{ final_swarms | int | string }}{% endif %}
            </span>
        </div>
        <script>
        // Only update the value if the user changes the inputs, not on page load
        function updateFinalSwarms() {
            const initial = parseInt(document.getElementById('initial').value, 10) || 0;
            const lands = parseInt(document.getElementById('lands').value, 10) || 0;
            const doubler = parseInt(document.getElementById('doubler').value, 10) || 0;
            // Use the same formula as backend
            const finalSwarms = initial + initial * lands * Math.pow(2, doubler);
            const el = document.getElementById('final-swarms-value');
            if (initial > 0 && lands >= 0) {
                el.textContent = finalSwarms.toLocaleString();
            } else {
                el.textContent = '';
            }
        }
        document.getElementById('initial').addEventListener('input', updateFinalSwarms);
        document.getElementById('lands').addEventListener('input', updateFinalSwarms);
        document.getElementById('doubler').addEventListener('input', updateFinalSwarms);
        // Do NOT call updateFinalSwarms() on page load, so backend value is shown initially
        </script>
    </form>
</body>
</html>
