<!DOCTYPE html>
<html>
<head>
    <title>Floating Mana Tracker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="manifest" href="/static/manifest.json">
    <meta name="theme-color" content="#1976d2">
    <link rel="icon" href="/static/img/mtg.ico">
    <link rel="apple-touch-icon" href="/static/img/mtg.ico">
    <link rel="stylesheet" href="/static/css/tiles.css">
    <link rel="stylesheet" href="/static/css/subpage.css">
    <link rel="stylesheet" href="/static/css/mana.css">
</head>
<body>
    <a href="/" class="back-arrow" aria-label="Back to main page">&#8592;</a>
    <div class="mana-filter-bar">
        <input type="checkbox" class="mana-toggle toggle-white" data-color="white" aria-label="Show white mana" checked>
        <input type="checkbox" class="mana-toggle toggle-blue" data-color="blue" aria-label="Show blue mana" checked>
        <input type="checkbox" class="mana-toggle toggle-black" data-color="black" aria-label="Show black mana" checked>
        <input type="checkbox" class="mana-toggle toggle-red" data-color="red" aria-label="Show red mana" checked>
        <input type="checkbox" class="mana-toggle toggle-green" data-color="green" aria-label="Show green mana" checked>
        <input type="checkbox" class="mana-toggle toggle-colorless" data-color="colorless" aria-label="Show colorless mana" checked>
        <button type="button" class="mana-square-btn" id="mana-add-all" aria-label="Add one mana of each color">+</button>
        <button type="button" class="mana-square-btn" id="mana-reset" aria-label="Reset all mana to zero">&#x21bb;</button>
    </div>
    <div class="tiles-container mana-grid">
        <div class="tile mana-tile white-mana" data-color="white">
            <button class="mana-control minus" data-color="white" aria-label="Spend white mana">-</button>
            <div class="mana-value" id="value-white">0</div>
            <button class="mana-control plus" data-color="white" aria-label="Add white mana">+</button>
            <span class="mana-label">White</span>
        </div>
        <div class="tile mana-tile blue-mana" data-color="blue">
            <button class="mana-control minus" data-color="blue" aria-label="Spend blue mana">-</button>
            <div class="mana-value" id="value-blue">0</div>
            <button class="mana-control plus" data-color="blue" aria-label="Add blue mana">+</button>
            <span class="mana-label">Blue</span>
        </div>
        <div class="tile mana-tile black-mana" data-color="black">
            <button class="mana-control minus" data-color="black" aria-label="Spend black mana">-</button>
            <div class="mana-value" id="value-black">0</div>
            <button class="mana-control plus" data-color="black" aria-label="Add black mana">+</button>
            <span class="mana-label">Black</span>
        </div>
        <div class="tile mana-tile red-mana" data-color="red">
            <button class="mana-control minus" data-color="red" aria-label="Spend red mana">-</button>
            <div class="mana-value" id="value-red">0</div>
            <button class="mana-control plus" data-color="red" aria-label="Add red mana">+</button>
            <span class="mana-label">Red</span>
        </div>
        <div class="tile mana-tile green-mana" data-color="green">
            <button class="mana-control minus" data-color="green" aria-label="Spend green mana">-</button>
            <div class="mana-value" id="value-green">0</div>
            <button class="mana-control plus" data-color="green" aria-label="Add green mana">+</button>
            <span class="mana-label">Green</span>
        </div>
        <div class="tile mana-tile colorless-mana" data-color="colorless">
            <button class="mana-control minus" data-color="colorless" aria-label="Spend colorless mana">-</button>
            <div class="mana-value" id="value-colorless">0</div>
            <button class="mana-control plus" data-color="colorless" aria-label="Add colorless mana">+</button>
            <span class="mana-label">Colorless</span>
        </div>
    </div>
    <script>
        const manaTotals = {
            white: 0,
            blue: 0,
            black: 0,
            red: 0,
            green: 0,
            colorless: 0,
        };

        const updateValue = (color) => {
            const el = document.getElementById(`value-${color}`);
            if (el) {
                el.textContent = manaTotals[color];
            }
        };

        document.querySelectorAll('.mana-control').forEach((btn) => {
            btn.addEventListener('click', () => {
                const { color } = btn.dataset;
                const delta = btn.classList.contains('plus') ? 1 : -1;
                manaTotals[color] = Math.max(0, manaTotals[color] + delta);
                updateValue(color);
            });
        });

        const toggleTile = (color, isVisible) => {
            const tile = document.querySelector(`.mana-tile[data-color="${color}"]`);
            if (tile) {
                tile.classList.toggle('is-hidden', !isVisible);
            }
        };

        const getToggle = (color) => document.querySelector(`.mana-toggle[data-color="${color}"]`);

        document.querySelectorAll('.mana-toggle').forEach((toggle) => {
            toggle.addEventListener('change', () => {
                const color = toggle.dataset.color;
                toggleTile(color, toggle.checked);
                if (!toggle.checked) {
                    manaTotals[color] = 0;
                    updateValue(color);
                }
            });
            // initialize state
            toggleTile(toggle.dataset.color, toggle.checked);
        });

        const resetButton = document.getElementById('mana-reset');
        if (resetButton) {
            resetButton.addEventListener('click', () => {
                Object.keys(manaTotals).forEach((color) => {
                    manaTotals[color] = 0;
                    updateValue(color);
                });
            });
        }

        const addAllButton = document.getElementById('mana-add-all');
        if (addAllButton) {
            addAllButton.addEventListener('click', () => {
                ['white', 'blue', 'black', 'red', 'green'].forEach((color) => {
                    manaTotals[color] += 1;
                    updateValue(color);
                    const toggle = getToggle(color);
                    if (toggle && !toggle.checked) {
                        toggle.checked = true;
                        toggleTile(color, true);
                    }
                });
            });
        }

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/static/js/service-worker.js');
            });
        }
    </script>
</body>
</html>
